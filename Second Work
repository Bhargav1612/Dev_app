private func showSearchOrTryAgainButtons() {
    // Hide the logo but keep the recognized text label visible
    logoImageView.isHidden = true
    recognizedTextLabel.isHidden = false

    // Create and style buttons
    let searchButton = UIButton(type: .custom)
    searchButton.setTitle("Search", for: .normal)
    searchButton.backgroundColor = UIColor.black
    searchButton.setTitleColor(UIColor.white, for: .normal)
    searchButton.layer.cornerRadius = 10
    searchButton.addTarget(self, action: #selector(searchUsingTextFromVoice), for: .touchUpInside)

    let tryAgainButton = UIButton(type: .custom)
    tryAgainButton.setTitle("Try Again", for: .normal)
    tryAgainButton.backgroundColor = UIColor.black
    tryAgainButton.setTitleColor(UIColor.white, for: .normal)
    tryAgainButton.layer.cornerRadius = 10
    tryAgainButton.addTarget(self, action: #selector(micIconPressed), for: .touchUpInside)

    // Add buttons to the overlay
    voiceSearchOverlay.addSubview(searchButton)
    voiceSearchOverlay.addSubview(tryAgainButton)

    // Set up constraints for the buttons to display them side by side
    searchButton.translatesAutoresizingMaskIntoConstraints = false
    tryAgainButton.translatesAutoresizingMaskIntoConstraints = false

    NSLayoutConstraint.activate([
        // Position buttons side by side
        searchButton.trailingAnchor.constraint(equalTo: tryAgainButton.leadingAnchor, constant: -20),
        searchButton.centerYAnchor.constraint(equalTo: voiceSearchOverlay.centerYAnchor),
        searchButton.heightAnchor.constraint(equalToConstant: 44),
        searchButton.widthAnchor.constraint(equalToConstant: 120),

        tryAgainButton.centerYAnchor.constraint(equalTo: searchButton.centerYAnchor),
        tryAgainButton.heightAnchor.constraint(equalTo: searchButton.heightAnchor),
        tryAgainButton.widthAnchor.constraint(equalTo: searchButton.widthAnchor),

        // Center the buttons horizontally within the overlay
        tryAgainButton.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor)
    ])
}



let logoImage = UIImage(named: "bhargav")
let logoImageView = UIImageView(image: logoImage)
logoImageView.translatesAutoresizingMaskIntoConstraints = false
voiceSearchOverlay.addSubview(logoImageView)

recognizedTextLabel = UILabel() // Ensure recognizedTextLabel is instantiated
recognizedTextLabel.text = "Listening..."
recognizedTextLabel.translatesAutoresizingMaskIntoConstraints = false
voiceSearchOverlay.addSubview(recognizedTextLabel)

// Define a constant for equal spacing
let spacing: CGFloat = 20.0 // Adjust this value as needed

NSLayoutConstraint.activate([
    // Logo constraints
    logoImageView.heightAnchor.constraint(equalToConstant: 60),
    logoImageView.widthAnchor.constraint(equalToConstant: 60),
    logoImageView.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
    logoImageView.topAnchor.constraint(equalTo: voiceSearchOverlay.topAnchor, constant: spacing),
    
    // Recognized text label constraints
    recognizedTextLabel.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
    recognizedTextLabel.topAnchor.constraint(equalTo: logoImageView.bottomAnchor, constant: spacing),
    recognizedTextLabel.bottomAnchor.constraint(equalTo: voiceSearchOverlay.bottomAnchor, constant: -spacing)
])


let recognizedTextLabel = UILabel() // Create a new label for recognized text
recognizedTextLabel.text = "Listening..."
recognizedTextLabel.translatesAutoresizingMaskIntoConstraints = false
recognizedTextLabel.textAlignment = .center // Center align the text
voiceSearchOverlay.addSubview(recognizedTextLabel)

NSLayoutConstraint.activate([
    recognizedTextLabel.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
    recognizedTextLabel.topAnchor.constraint(equalTo: logoImageView.bottomAnchor, constant: 16)
])


// Placeholder music animation view (to simulate the animation)
private var musicAnimationView: UIView = {
    let view = UIView(frame: .zero)
    view.backgroundColor = UIColor.systemBlue // Replace this with actual animation
    view.translatesAutoresizingMaskIntoConstraints = false
    view.isHidden = false // Show initially, hide later
    return view
}()

// Add music animation to the voice search overlay
voiceSearchOverlay.addSubview(musicAnimationView)
NSLayoutConstraint.activate([
    musicAnimationView.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
    musicAnimationView.topAnchor.constraint(equalTo: voiceSearchOverlay.topAnchor, constant: 16),
    musicAnimationView.heightAnchor.constraint(equalToConstant: 60),
    musicAnimationView.widthAnchor.constraint(equalToConstant: 60)
])


musicAnimationView.isHidden = false // Show music animation initially


DispatchQueue.main.async {
    self.musicAnimationView.isHidden = true // Hide animation after speech starts
}

private func showSearchOrTryAgainButtons() {
    let searchButton = UIButton()
    searchButton.setTitle("Search", for: .normal)
    searchButton.backgroundColor = .systemBlue
    searchButton.translatesAutoresizingMaskIntoConstraints = false
    voiceSearchOverlay.addSubview(searchButton)
    searchButton.addTarget(self, action: #selector(searchUsingTextFromVoice), for: .touchUpInside)

    let tryAgainButton = UIButton()
    tryAgainButton.setTitle("Try Again", for: .normal)
    tryAgainButton.backgroundColor = .systemGray
    tryAgainButton.translatesAutoresizingMaskIntoConstraints = false
    voiceSearchOverlay.addSubview(tryAgainButton)
    tryAgainButton.addTarget(self, action: #selector(startListening), for: .touchUpInside)

    NSLayoutConstraint.activate([
        searchButton.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
        searchButton.topAnchor.constraint(equalTo: voiceSearchOverlay.topAnchor, constant: 100),
        searchButton.widthAnchor.constraint(equalToConstant: 100),
        searchButton.heightAnchor.constraint(equalToConstant: 40),
        
        tryAgainButton.centerXAnchor.constraint(equalTo: voiceSearchOverlay.centerXAnchor),
        tryAgainButton.topAnchor.constraint(equalTo: searchButton.bottomAnchor, constant: 16),
        tryAgainButton.widthAnchor.constraint(equalToConstant: 100),
        tryAgainButton.heightAnchor.constraint(equalToConstant: 40)
    ])
}


if error != nil || (result?.isFinal ?? false) {
    self.stopListening()
    self.showSearchOrTryAgainButtons() // Show buttons to proceed
}
