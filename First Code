var searchHistoryTableView: UITableView!

func loadSearchHistory() -> [String] {
    return UserDefaults.standard.stringArray(forKey: "searchHistory") ?? []
}

open override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
    if tableView == searchHistoryTableView {
        return loadSearchHistory().count
    } else if tableView == searchSuggestionsTableView {
        return searchMoleculesInfo?.count ?? 0
    }
    return 0
}

open override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    if tableView == searchHistoryTableView {
        let cell = tableView.dequeueReusableCell(withIdentifier: "HistoryCell") ?? UITableViewCell(style: .default, reuseIdentifier: "HistoryCell")
        let searchHistory = loadSearchHistory()
        cell.textLabel?.text = searchHistory[indexPath.row] // Display the search history
        return cell
    } else if tableView == searchSuggestionsTableView {
        guard let moleculeInfo = searchMoleculesInfo?[indexPath.row],
              let cell = tableView.dequeueReusableCell(withIdentifier: moleculeInfo.identifier) else {
            return UITableViewCell()
        }
        // Set up your cell as before for searchSuggestionsTableView
        return cell
    }
    return UITableViewCell() // Fallback
}


public override func textFieldShouldReturn(_ textField: UITextField) -> Bool {
    handleSearchDoneAction(textField.text)
    
    // Toggle the visibility of table views based on the search field's content
    if let searchText = textField.text, searchText.isEmpty {
        searchHistoryTableView.isHidden = false
        searchSuggestionsTableView.isHidden = true
        searchHistoryTableView.reloadData() // Load and display the history
    } else {
        searchHistoryTableView.isHidden = true
        searchSuggestionsTableView.isHidden = false
    }
    
    return true
}

override func viewDidLoad() {
    super.viewDidLoad()
    
    setupSearchSuggestionsTableView()
    setupSearchHistoryTableView() // Call to setup the history table
}
