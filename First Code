import UIKit

class BookmarksViewController: UIViewController, UITableViewDataSource {

    var tableView: UITableView!
    var bookmarks: [[String: Any]] = []

    override func viewDidLoad() {
        super.viewDidLoad()

        // Set up the table view
        tableView = UITableView(frame: view.bounds)
        tableView.dataSource = self
        view.addSubview(tableView)

        // Call the method to load the data
        newData()
    }

    // MARK: - Parse the JSON data
    override func newData() {
        // Assuming loadObject?.pageJson contains your JSON data
        guard let data = loadObject?.pageJson as? [String: Any],
              let page = data["Page"] as? [String: Any],
              let bookmarksArray = page["bookmarks"] as? [[String: Any]] else {
            print("Failed to parse JSON data")
            return
        }

        // Store the bookmarks in the array for the table view
        self.bookmarks = bookmarksArray
        tableView.reloadData()
    }

    // MARK: - UITableViewDataSource

    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return bookmarks.count
    }

    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "cell") ?? UITableViewCell(style: .subtitle, reuseIdentifier: "cell")
        
        // Get the bookmark data for the current row
        let bookmark = bookmarks[indexPath.row]
        
        // Display "actionType" and "pageType" in the cell's textLabel and "requestURL" in the detailTextLabel
        cell.textLabel?.text = "\(bookmark["actionType"] as? String ?? "") - \(bookmark["pageType"] as? String ?? "")"
        cell.detailTextLabel?.text = bookmark["requestURL"] as? String

        return cell
    }
}
